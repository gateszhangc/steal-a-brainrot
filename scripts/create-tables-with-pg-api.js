async function createTablesWithPGAPI() {
  const supabaseUrl = 'https://ptukqwqbpjzqpqzvlrle.supabase.co'
  const serviceKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InB0dWtxd3FicGp6cXBxenZscmxlIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc2MjgyOTcwOSwiZXhwIjoyMDc4NDA1NzA5fQ.OtYT3SuQgbACbWOR6hHAEsKNqkUhMEOcb7d-QqSnXTc'

  console.log('ğŸš€ ä½¿ç”¨ Supabase PostgreSQL API åˆ›å»ºè¡¨...')

  // åŸºæœ¬çš„ CREATE TABLE è¯­å¥
  const createTableSQL = `
    CREATE TABLE IF NOT EXISTS comments (
      id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
      author VARCHAR(100) NOT NULL,
      email VARCHAR(255) NOT NULL,
      content TEXT NOT NULL,
      parent_id BIGINT DEFAULT 0,
      game_id VARCHAR(100) NOT NULL DEFAULT 'steal-brainrot',
      status VARCHAR(20) NOT NULL DEFAULT 'pending',
      ip_address INET,
      user_agent TEXT,
      like_count INTEGER DEFAULT 0,
      dislike_count INTEGER DEFAULT 0,
      created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
      updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
    );
  `

  try {
    // æ–¹æ³•1: ä½¿ç”¨ Supabase çš„ direct postgres API
    console.log('\nğŸ“‹ æ–¹æ³•1: ä½¿ç”¨ Postgres REST API...')

    const response = await fetch(`${supabaseUrl}/rest/v1/`, {
      method: 'POST',
      headers: {
        'apikey': serviceKey,
        'Authorization': `Bearer ${serviceKey}`,
        'Content-Type': 'application/sql'
      },
      body: createTableSQL
    })

    console.log('Postgres API å“åº”:', response.status)
    const result = await response.text()
    console.log('Postgres API ç»“æœ:', result)

    // æ–¹æ³•2: å°è¯•ä½¿ç”¨ /rpc/v1/sql
    console.log('\nğŸ“‹ æ–¹æ³•2: ä½¿ç”¨ RPC SQL API...')

    const rpcResponse = await fetch(`${supabaseUrl}/rpc/v1/sql`, {
      method: 'POST',
      headers: {
        'apikey': serviceKey,
        'Authorization': `Bearer ${serviceKey}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        query: createTableSQL.trim()
      })
    })

    console.log('RPC SQL API å“åº”:', rpcResponse.status)
    const rpcResult = await rpcResponse.text()
    console.log('RPC SQL API ç»“æœ:', rpcResult)

    // æ–¹æ³•3: å°è¯•ä½¿ç”¨ /sql ç«¯ç‚¹
    console.log('\nğŸ“‹ æ–¹æ³•3: ä½¿ç”¨ /sql ç«¯ç‚¹...')

    const sqlResponse = await fetch(`${supabaseUrl}/sql`, {
      method: 'POST',
      headers: {
        'apikey': serviceKey,
        'Authorization': `Bearer ${serviceKey}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        sql: createTableSQL.trim()
      })
    })

    console.log('SQL ç«¯ç‚¹å“åº”:', sqlResponse.status)
    const sqlResult = await sqlResponse.text()
    console.log('SQL ç«¯ç‚¹ç»“æœ:', sqlResult)

    // æ–¹æ³•4: å°è¯•ä½¿ç”¨ pg-admin é£æ ¼çš„ API
    console.log('\nğŸ“‹ æ–¹æ³•4: ä½¿ç”¨ pgadmin é£æ ¼ API...')

    const pgResponse = await fetch(`${supabaseUrl}/pg`, {
      method: 'POST',
      headers: {
        'apikey': serviceKey,
        'Authorization': `Bearer ${serviceKey}`,
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        sql: createTableSQL.trim()
      })
    })

    console.log('PG API å“åº”:', pgResponse.status)
    const pgResult = await pgResponse.text()
    console.log('PG API ç»“æœ:', pgResult)

    // éªŒè¯è¡¨æ˜¯å¦åˆ›å»ºæˆåŠŸ
    console.log('\nğŸ” éªŒè¯è¡¨åˆ›å»ºç»“æœ...')

    const verifyResponse = await fetch(`${supabaseUrl}/rest/v1/comments?select=count()`, {
      method: 'GET',
      headers: {
        'apikey': serviceKey,
        'Authorization': `Bearer ${serviceKey}`,
        'Prefer': 'count=exact'
      }
    })

    console.log('éªŒè¯å“åº”:', verifyResponse.status)
    const verifyResult = await verifyResponse.text()
    console.log('éªŒè¯ç»“æœ:', verifyResult)

    if (verifyResponse.ok) {
      console.log('âœ… è¡¨åˆ›å»ºæˆåŠŸ!')
    } else {
      console.log('âŒ è¡¨åˆ›å»ºå¤±è´¥')
    }

  } catch (error) {
    console.error('âŒ åˆ›å»ºè¡¨æ—¶å‡ºé”™:', error.message)
  }
}

createTablesWithPGAPI()